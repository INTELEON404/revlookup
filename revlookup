#!/usr/bin/env python3
"""
RevLookup v2.1 - INTELEON404
GitHub: https://github.com/INTELEON404
"""
import threading
import argparse
import ipaddress
import socket
import re
import time
from pathlib import Path
from pyfiglet import Figlet

# Pagga font – pure violence
f = Figlet(font='pagga')
banner_text = f.renderText("RevLookup")

def banner():
    print("\033[96m")
    print(banner_text)
    print("\033[93m          [+] Version: 2.1")
    print("          [+] Mod by: INTELEON404")
    print("          [+] GitHub: https://github.com/INTELEON404\n")
    print("      \033[97mBrutal. Fast. Unstoppable.\033[0m")
    time.sleep(1.8)

def rev(ip: str):
    try:
        host = socket.gethostbyaddr(ip.strip())[0]
        print(f"\033[92m{host}\033[0m")
        if args.output:
            with open(args.output, "a", encoding="utf-8") as f:
                f.write(host + "\n")
    except:
        pass

# =================== FIXED ARGS ===================
parser = argparse.ArgumentParser(
    description="RevLookup v2.1 - INTELEON404",
    add_help=False  # we control -h ourselves
)

parser.add_argument("-t", "--target", type=str, help="Single IP or domain")
parser.add_argument("-f", "--file", type=str, help="File with IPs/domains/CIDRs")
parser.add_argument("-c", "--cidr", type=str, help="CIDR range (ex: 13.35.0.0/16)")
parser.add_argument("-o", "--output", type=str, help="Save results")
parser.add_argument("-td", "--threads", type=int, default=1337, help="Max threads (default: 1337)")
parser.add_argument("-s", "--silent", action="store_true", help="No banner")
parser.add_argument("-h", "--help", action="help", help="Show this help message and exit")

args = parser.parse_args()

# Proper help trigger
if len(__import__("sys").argv) == 1 or args.help:
    parser.print_help()
    exit()

socket.setdefaulttimeout(7)

if not args.silent:
    banner()

# Input validation
if sum(bool(x) for x in [args.target, args.file, args.cidr]) != 1:
    print("\033[91m[!] Use exactly one input: -t | -f | -c\033[0m")
    exit()

max_threads = max(1, min(5000, args.td))
sem = threading.Semaphore(max_threads)
threads = []

def start(ip: str):
    with sem:
        rev(ip)

# =================== Main logic ===================
if args.target:
    if re.fullmatch(r"\d{1,3}(\.\d{1,3}){3}", args.target):
        t = threading.Thread(target=start, args=(args.target,))
        t.start()
        threads.append(t)
    else:
        try:
            ips = socket.gethostbyname_ex(args.target)[2]
            for ip in ips:
                t = threading.Thread(target=start, args=(ip,))
                t.start()
                threads.append(t)
        except:
            print(f"\033[91m[!] Cannot resolve: {args.target}\033[0m")

elif args.cidr:
    try:
        net = ipaddress.ip_network(args.cidr, strict=False)
        for ip in net.hosts():
            t = threading.Thread(target=start, args=(str(ip),))
            t.start()
            threads.append(t)
    except Exception as e:
        print(f"\033[91m[!] Invalid CIDR → {e}\033[0m")
        exit()

elif args.file:
    path = Path(args.file)
    if not path.exists():
        print(f"\033[91m[!] File not found: {args.file}\033[0m")
        exit()

    for line in path.read_text(encoding="utf-8").splitlines():
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        if "/" in line:
            try:
                net = ipaddress.ip_network(line, strict=False)
                for ip in net.hosts():
                    t = threading.Thread(target=start, args=(str(ip),))
                    t.start()
                    threads.append(t)
            except:
                continue
        else:
            t = threading.Thread(target=start, args=(line,))
            t.start()
            threads.append(t)

# =================== Finish ===================
for t in threads:
    t.join()

print("\n\033[96m[+] Hunt complete.\033[0m")
print("\033[93m    ~ INTELEON404\033[0m")
