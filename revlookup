#!/usr/bin/env python3
"""
RevLookup v2.3 - INTELEON404
GitHub: https://github.com/INTELEON404
"""
import threading
import argparse
import ipaddress
import socket
import re
import time
import sys
from pathlib import Path
from pyfiglet import Figlet

# === Pagga Font â€“ Raw Power ===
f = Figlet(font='pagga')
banner_text = f.renderText("RevLookUp")

def banner():
    print("\033[96m")
    print(banner_text.rstrip())
    print("\033[93m          [+] Version: 2.3")
    print("          [+] Mod by: INTELEON404")
    print("          [+] GitHub: https://github.com/INTELEON404\n")
    time.sleep(1.5)

def rev(ip: str):
    try:
        host = socket.gethostbyaddr(ip.strip())[0]
        print(f"\033[92m{host}\033[0m")
        if args.output:
            with open(args.output, "a", encoding="utf-8") as f:
                f.write(host + "\n")
    except:
        pass

# =================== ARGPARSE ===================
parser = argparse.ArgumentParser(
    description="RevLookup v2.3 - INTELEON404",
    formatter_class=argparse.RawTextHelpFormatter
)

parser.add_argument("-t", "--target", type=str, help="Single IP or domain")
parser.add_argument("-f", "--file", type=str, help="File with IPs/domains/CIDRs")
parser.add_argument("-c", "--cidr", type=str, help="CIDR range (ex: 13.35.0.0/16)")
parser.add_argument("-o", "--output", type=str, help="Save results to file")
parser.add_argument("-td", "--threads", type=int, default=1337, help="Max threads (default: 1337)")
parser.add_argument("-s", "--silent", action="store_true", help="No banner")

args = parser.parse_args()

# === Show help if no args or explicit -h / --help ===
if len(sys.argv) == 1 or "-h" in sys.argv or "--help" in sys.argv:
    parser.print_help()
    sys.exit(0)

socket.setdefaulttimeout(7)

if not args.silent:
    banner()

# Input validation
if sum(bool(x) for x in [args.target, args.file, args.cidr]) != 1:
    print("\033[91m[!] Use exactly one: -t | -f | -c\033[0m")
    sys.exit(1)

# Thread handling
max_threads = max(1, min(5000, args.threads))
sem = threading.Semaphore(max_threads)
threads = []

def start(ip: str):
    with sem:
        rev(ip)

# =================== MAIN LOGIC ===================
if args.target:
    if re.fullmatch(r"\d{1,3}(\.\d{1,3}){3}", args.target):
        t = threading.Thread(target=start, args=(args.target,), daemon=True)
        t.start()
        threads.append(t)
    else:
        try:
            ips = socket.gethostbyname_ex(args.target)[2]  # FIXED
            for ip in ips:
                t = threading.Thread(target=start, args=(ip,), daemon=True)
                t.start()
                threads.append(t)
        except:
            print(f"\033[91m[!] Cannot resolve: {args.target}\033[0m")

elif args.cidr:
    try:
        net = ipaddress.ip_network(args.cidr, strict=False)
        total = net.num_addresses - 2 if net.num_addresses > 2 else 0
        print(f"\033[93m[+] Scanning {total:,} hosts in {args.cidr}...\033[0m\n")
        for ip in net.hosts():
            t = threading.Thread(target=start, args=(str(ip),), daemon=True)
            t.start()
            threads.append(t)
    except Exception as e:
        print(f"\033[91m[!] Invalid CIDR: {e}\033[0m")
        sys.exit(1)

elif args.file:
    path = Path(args.file)
    if not path.exists():
        print(f"\033[91m[!] File not found: {args.file}\033[0m")
        sys.exit(1)

    for line in path.read_text(encoding="utf-8").splitlines():
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        if "/" in line:
            try:
                net = ipaddress.ip_network(line, strict=False)
                for ip in net.hosts():
                    t = threading.Thread(target=start, args=(str(ip),), daemon=True)
                    t.start()
                    threads.append(t)
            except:
                continue
        else:
            t = threading.Thread(target=start, args=(line,), daemon=True)
            t.start()
            threads.append(t)

# =================== Finish ===================
for t in threads:
    t.join()

print("\n\033[96m[+] Hunt complete.\033[0m")
print("\033[93m    ~ INTELEON404\033[0m")
