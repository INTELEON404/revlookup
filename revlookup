#!/usr/bin/env python3
"""
RevLookup v2.2 - INTELEON404
GitHub: https://github.com/INTELEON404
"""
import threading
import argparse
import ipaddress
import socket
import re
import time
from pathlib import Path

# Pagga font = raw power
from pyfiglet import Figlet
f = Figlet(font='pagga')
banner_text = f.renderText("RevLookup")

def banner():
    print("\033[96m")
    print(banner_text)
    print("\033[93m          [+] Version: 2.2")
    print("          [+] Mod by: INTELEON404")
    print("          [+] GitHub: https://github.com/INTELEON404\n")
    print("      \033[97mBrutal. Fast. Unstoppable.\033[0m")
    time.sleep(1.8)

def rev(ip):
    try:
        host = socket.gethostbyaddr(ip.strip())[0]
        print(f"\033[92m{host}\033[0m")
        if args.output:
            with open(args.output, "a", encoding="utf-8") as f:
                f.write(host + "\n")
    except:
        pass

# =================== Args ===================
parser = argparse.ArgumentParser(description="RevLookup v2.2 - INTELEON404")
parser.add_argument("-t", "--target", help="Single IP or domain")
parser.add_argument("-f", "--file", help="File with IPs/domains/CIDRs")
parser.add_argument("-c", "--cidr", help="CIDR range (ex: 1.1.1.1/24)")
parser.add_argument("-o", "--output", help="Save results")
parser.add_argument("-td", "--threads", type=int, default=1337, help="Max threads (default: 1337)")
parser.add_argument("-s", "--silent", action="store_true", help="No banner")
args = parser.parse_args()

socket.setdefaulttimeout(7)

if not args.silent:
    banner()

if sum(bool(x) for x in [args.target, args.file, args.cidr]) != 1:
    print("\033[91m[!] Use only one input: -t | -f | -c\033[0m")
    exit()

max_threads = max(1, min(5000, args.td))
sem = threading.Semaphore(max_threads)
threads = []

def start(ip):
    with sem:
        rev(ip)

# =================== Input handlers ===================
if args.target:
    if re.match(r"^\d{1,3}(\.\d{1,3}){3}$", args.target):
        t = threading.Thread(target=start, args=(args.target,))
        t.start()
        threads.append(t)
    else:
        try:
            ips = socket.gethostbyname_ex(args.target)[2]
            for ip in ips:
                t = threading.Thread(target=start, args=(ip,))
                t.start()
                threads.append(t)
        except:
            print(f"\033[91m[!] Failed to resolve: {args.target}\033[0m")

elif args.cidr:
    try:
        net = ipaddress.ip_network(args.cidr, strict=False)
        for ip in net.hosts():
            t = threading.Thread(target=start, args=(str(ip),))
            t.start()
            threads.append(t)
    except:
        print("\033[91m[!] Invalid CIDR\033[0m")
        exit()

elif args.file:
    path = Path(args.file)
    if not path.exists():
        print(f"\033[91m[!] File not found: {args.file}\033[0m")
        exit()

    for line in path.read_text(encoding="utf-8").splitlines():
        line = line.strip()
        if not line or line.startswith("#"):
            continue

        if "/" in line:
            try:
                net = ipaddress.ip_network(line, strict=False)
                for ip in net.hosts():
                    t = threading.Thread(target=start, args=(str(ip),))
                    t.start()
                    threads.append(t)
            except:
                continue
        else:
            t = threading.Thread(target=start, args=(line,))
            t.start()
            threads.append(t)

# =================== Finish ===================
for t in threads:
    t.join()

print("\n\033[96m[+] Mission complete.\033[0m")
print("\033[93m    ~ INTELEON404\033[0m")
